@model PassPast.ViewModels.ExamsViewModel

@{
    Layout = "~/Views/Shared/_ExamsLayout.cshtml";
}

<!-- Main Column -->
<div class="col-md-7">
	<!-- Check if an exam has actually been selected -->
	@if (ViewBag.ExamName == null)
	{
		<h1>Error</h1><br />
		<p>You must select an exam first.</p>
		<p><br /><a href="../Home/Index">< return home</a></p>
	}
	else
	{
		if (@ViewBag.ExamName.Substring(4, 1) == "3")
		{
			<div class="paper-title">
				<h1>@ViewBag.CourseCode @ViewBag.PaperName</h1>
				<h2>@ViewBag.ExamName.Substring(0, 4) Summer Semester</h2>
			</div>
		}
		else
		{
			<div class="paper-title">
				<h1>@ViewBag.CourseCode @ViewBag.PaperName</h1>
				<h2>@ViewBag.ExamName.Substring(0, 4) Semester @ViewBag.ExamName.Substring(4, 1)</h2>
			</div>
		}
	}
	<!-- End headings, begin MCQ content -->


	@foreach (var question in ViewBag.Questions)
	{
		var firstIteration = true;
		<div class="col-md-5 poll-box">
                <input type="hidden" name="TypeOfVote" value="Down" />
			    <table class="table table-condensed table-borderless">
				    <tbody>
					    @foreach (var answer in question.Answers)
					    {
						    <tr>
							    <!-- So the question number is only displayed once -->
							    @if (firstIteration)
							    {
								    <th class="col-md-1 col-sm-1 col-xs-1">@question.Number.</th>

								    firstIteration = false;
							    }
							    else
							    {
								    <th class="col-md-1 col-sm-1 col-xs-1">&nbsp;</th>
							    }
							    <!-- Name is A, B, C etc. -->
							    <td class="col-md-1 col-sm-1 col-xs-1">
                                    <form id="McqVote" action = "/Exams/AddVote" method="post"> <!---->
                                        <input type="hidden" name="QuestionId" value="@question.Id" />
                                        <input type="hidden" name="AnswerId" value="@answer.Id" />
                                        <input type="submit" name="submit" class="btn btn-default submit-button vote-submit-button mcq-name" value="@answer.Name" />
                                    </form>
                                </td>
							    @if (answer.Votes == 0)
							    {
								    <td class="col-md-9 col-sm-9 col-xs-9"><div class="poll-bar-grey" style="width: 0.5%;">&nbsp;</div></td>
								    <td class="col-md-1 col-sm-1 col-xs-1">@answer.Votes</td>
                                    
                                }
                                else if (answer.Votes > (question.TotalVotes / 2))
                                {
								    <!-- Sets the poll bar to be coloured for only a percentage of the width -->
								    <td class="col-md-9 col-sm-9 col-xs-9"><div class="poll-bar-green" style="width: @Math.Ceiling(((double)answer.Votes / (double)question.TotalVotes) * 100)%;">&nbsp;</div></td>
								    <td class="col-md-1 col-sm-1 col-xs-1"><strong>@answer.Votes</strong></td>
							    }
							    else
							    {
								    <td class="col-md-9 col-sm-9 col-xs-9"><div class="poll-bar-red" style="width: @Math.Ceiling(((double)answer.Votes / (double)question.TotalVotes) * 100)%;">&nbsp;</div></td>
								    <td class="col-md-1 col-sm-1 col-xs-1">@answer.Votes</td>
							    }
						    </tr>
					    }
				    </tbody>
			    </table>
			<table class="table table-condensed table-borderless">
				<tbody>
					<tr>
						<td class="col-md-1 col-sm-1 col-xs-1">&nbsp;</td>
						<td>
							<!-- Comments are not displayed by default -->
							<button class="btn btn-default" role="button" onclick="viewComments(@question.Id);">view comments</button>
							<!-- Calls the toggleVisibility function in script.js -->
							<button class="btn btn-default" role="button" onclick="toggleVisibility('comment-form-@question.Id');">vote</button>
							<form class="comment-form" id="comment-form-@question.Id" action="/Exams/AddVote" method="post">
								<select name="AnswerId">
									@foreach (var answer in question.Answers)
									{
										<option value="@answer.Id">@answer.Name</option>
									}
								</select>
								<input type="hidden" name="QuestionId" value="@question.Id" />
								<input type="submit" name="submit" class="btn btn-default submit-button" value="submit" />
							</form>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	}
</div>

<!-- Comments Column -->
<div class="col-md-5 right-sidebar-div"></div>